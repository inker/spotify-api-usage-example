"use strict";(self.webpackChunkspotify_api_usage_example=self.webpackChunkspotify_api_usage_example||[]).push([[143],{9462:(e,t,s)=>{s(6487);var a=s(538),n=s(4765),r=s.n(n),i=s(266),o=s(629),c=s(1463),l=s.n(c);const u=e=>{return"set"+`${(t=e)[0].toUpperCase()}${t.slice(1)}`;var t},d=e=>(t,s)=>{t[e]=s},m=e=>[u(e),d(e)],p=e=>Object.fromEntries(e.map(m)),h=Object.freeze({colorTheme:"light",systemTheme:null}),v={namespaced:!0,state:{...h},getters:{isDarkMode(e){const{colorTheme:t}=e;return"dark"===t||"auto"===t&&"dark"===e.systemTheme}},mutations:p(Object.keys(h))},f=Object.freeze({x:void 0}),_={namespaced:!0,state:{...f},mutations:{...p(Object.keys(f)),resetState(e){Object.assign(e,f)}}};var y=s(8345),g=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)};g._withStripped=!0;var k=s(1900),b=(0,k.Z)({},g,[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"not-found-root"},[s("div",{staticClass:"not-found-text"},[e._v("\n    Page not found\n  ")])])}],!1,null,"28345dd6",null);b.options.__file="src/pages/NotFound/index.vue";const w=b.exports;var C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"login-root"},[s("form",{on:{submit:function(t){return t.preventDefault(),e.signIn.apply(null,arguments)}}},[s("button",{staticClass:"login-button",attrs:{type:"submit"}},[e._v("\n      Sign in via Spotify\n    ")])])])};C._withStripped=!0;const S={methods:{...(0,o.nv)("auth",{signIn:"signIn"})}};var T=(0,k.Z)(S,C,[],!1,null,"2ddd9490",null);T.options.__file="src/pages/Login/index.vue";const x=T.exports;var M=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Layout",{scopedSlots:e._u([{key:"sidebar",fn:function(){return[s("div",{staticClass:"menu-container"},[s("div",{staticClass:"menu-top"},[s("ThemeSelector"),e._v(" "),s("ArtistsList",{attrs:{list:e.recentArtists,selectedId:e.selectedArtistId}})],1),e._v(" "),s("MenuFooter")],1)]},proxy:!0},{key:"content",fn:function(){return[s("div",{staticClass:"content-container"},[e.selectedArtistId?s("router-link",{staticClass:"unselect-link",attrs:{to:{query:{artist:void 0}}}},[e._v("\n        Display all artists\n      ")]):e._e(),e._v(" "),e.displayedTracks?s("fragment",[e.displayedTracks.length>0?s("ul",{staticClass:"track-grid"},e._l(e.displayedTracks,(function(e){return s("li",{key:e.track.id},[s("TrackCard",{attrs:{item:e}})],1)})),0):s("div",[e._v("\n          No tracks found\n        ")])]):e._e(),e._v(" "),s("div",[s("button",{attrs:{type:"button"},on:{click:e.onClickPrev}},[e._v("\n          Prev\n        ")]),e._v(" "),s("button",{attrs:{type:"button"},on:{click:e.onClickNext}},[e._v("\n          Next\n        ")])])],1)]},proxy:!0}])})};M._withStripped=!0;var E=s(5578),L=s.n(E),D=s(6033),$=s(3092);class R extends Error{constructor(e){super(e),this.name="RequestError"}}class O extends Error{constructor(e){super(e),this.name="UnauthorizedError"}}var P=s(6604),Z=s.n(P),I=s(4293),A=s.n(I);const z=e=>{if(A()(e))return"";const t=Z()(e,String);return new URLSearchParams(t).toString()};function j(e,t,s){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}var U=new WeakMap;const q=new class{constructor(){j(this,U,{writable:!0,value:void 0})}setAccessToken(e){(0,$.Z)(this,U,e)}async requestJson(e,t){const s=t?`${e}?${z(t)}`:e,a=await fetch(s,{headers:{Authorization:`Bearer ${(0,D.Z)(this,U)}`}}),n=await a.json();if(a.ok)return n;if(401===a.status)throw new O(n.error.message);throw new R(n.error.message)}getCurrentUser(){return this.requestJson("https://api.spotify.com/v1/me")}getRecentlyPlayedTracks(e){return this.requestJson("https://api.spotify.com/v1/me/player/recently-played",e)}};function B(e,t,s){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}var N=new WeakMap,W=new WeakMap;const J=new class{constructor(){B(this,N,{writable:!0,value:void 0}),B(this,W,{writable:!0,value:void 0})}setRouter(e){(0,$.Z)(this,N,e)}setStore(e){(0,$.Z)(this,W,e)}async handle(e){console.error(e),e instanceof O&&((0,D.Z)(this,W).dispatch("auth/signOut"),await(0,D.Z)(this,N).push({name:"login"})),a.default.notify({group:"global",title:"Error",text:e.message})}};var K=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dashboard-root"},[s("Resize",{model:{value:e.isResizing,callback:function(t){e.isResizing=t},expression:"isResizing"}}),e._v(" "),s("div",{staticClass:"sidebar",style:{width:e.sideBarLeft}},[e._t("sidebar")],2),e._v(" "),s("main",{staticClass:"content",style:{"margin-left":e.sideBarLeft}},[e._t("content")],2)],1)};K._withStripped=!0;var F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("fragment",[s("GlobalEvents",{on:{mousemove:function(t){return t.stopPropagation(),e.onMouseMove.apply(null,arguments)},mouseup:function(t){return t.stopPropagation(),e.onMouseUp.apply(null,arguments)}}}),e._v(" "),s("GlobalClassList",{attrs:{value:e.globalClass}}),e._v(" "),s("div",{staticClass:"resize-bar",style:{left:e.x},on:{mousedown:e.onMouseDown}})],1)};F._withStripped=!0;var G=s(4691),X=s.n(G),H=s(8849),Y=s(7361),Q=s.n(Y);const V={props:{value:String,target:{type:[String,Array],default:()=>["document","body"]}},computed:{targetClassList(){return Q()(window,this.target).classList}},watch:{value(e,t){t&&this.targetClassList.remove(t),e&&this.targetClassList.add(e)},target(e,t){window[t].classList.remove(this.value),window[e].classList.add(this.value)}},mounted(){this.value&&this.targetClassList.add(this.value)},beforeDestroy(){this.value&&this.targetClassList.remove(this.value)},render:e=>e()},ee={name:"Resize",components:{GlobalEvents:H.Z,GlobalClassList:V},props:{value:Boolean},computed:{...(0,o.rn)("sidebar",["x"]),globalClass(){return this.value?"global-resizing":void 0}},methods:{...(0,o.OI)("sidebar",["setX","resetState"]),onMouseDown(){this.$emit("input",!0)},onMouseMove(e){if(!this.value)return;const t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=Math.max(.1*t,225),a=.4*t,n=Math.round(X()(e.clientX,s,a));this.setX(`${n}px`)},onMouseUp(){this.$emit("input",!1)}}};var te=(0,k.Z)(ee,F,[],!1,null,"92dbdcb4",null);te.options.__file="src/ui/Resize.vue";const se={components:{Resize:te.exports},data:()=>({isResizing:!1}),computed:{...(0,o.rn)("sidebar",{sideBarLeft:"x"})}};var ae=(0,k.Z)(se,K,[],!1,null,"50bf451c",null);ae.options.__file="src/ui/Layout.vue";const ne=ae.exports;var re=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"theme-selector-root"},[s("Radio",{attrs:{name:e.name,list:e.list,selected:e.colorTheme},on:{input:e.setColorTheme}})],1)};re._withStripped=!0;const ie=()=>Math.random().toString(36).slice(2);var oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"radio-root"},e._l(e.list,(function(t){return s("label",{key:t.value,staticClass:"theme-item",class:{selected:t.value===e.selected}},[s("input",{attrs:{type:"radio",name:e.name},domProps:{value:t.value,checked:t.value===e.selected},on:{input:function(s){return e.$emit("input",t.value)}}}),e._v("\n    "+e._s(t.label)+"\n  ")])})),0)};oe._withStripped=!0;const ce={props:{name:String,list:Array,selected:String}};var le=(0,k.Z)(ce,oe,[],!1,null,"e538135c",null);le.options.__file="src/ui/ThemeSelector/Radio.vue";const ue={components:{Radio:le.exports},data:()=>({name:ie(),list:[{value:"light",label:"Light theme"},{value:"dark",label:"Dark theme"},{value:"auto",label:"System theme"}]}),computed:{...(0,o.rn)("appearance",{colorTheme:"colorTheme"})},methods:{...(0,o.OI)("appearance",{setColorTheme:"setColorTheme"})}};var de=(0,k.Z)(ue,re,[],!1,null,"1fa4a7c9",null);de.options.__file="src/ui/ThemeSelector/index.vue";const me=de.exports;var pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"artists-title"},[e._v("\n    Recently played artists:\n  ")]),e._v(" "),e.list?s("ul",{staticClass:"artist-list"},e._l(e.list,(function(t){return s("li",{key:t.id},[s("router-link",{staticClass:"artist-link",attrs:{to:{query:{artist:t.id}}}},[s("MenuItem",{attrs:{text:t.name,isSelected:t.id===e.selectedId}})],1)],1)})),0):e._e()])};pe._withStripped=!0;var he=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"artist-item-root",class:{selected:e.isSelected}},[s("div",{staticClass:"name"},[e._v("\n    "+e._s(e.text)+"\n  ")])])};he._withStripped=!0;const ve={props:{text:String,isSelected:Boolean}};var fe=(0,k.Z)(ve,he,[],!1,null,"7f5f6d1e",null);fe.options.__file="src/pages/Dashboard/MenuItem.vue";const _e=fe.exports,ye={components:{MenuItem:_e},props:{list:Array,selectedId:String}};var ge=(0,k.Z)(ye,pe,[],!1,null,"e658eb8a",null);ge.options.__file="src/pages/Dashboard/ArtistsList.vue";const ke=ge.exports;var be=function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("router-link",{staticClass:"logout-link",attrs:{to:{name:"logout"}}},[t("MenuItem",{attrs:{text:"Sign out"}})],1)],1)};be._withStripped=!0;const we={components:{MenuItem:_e},methods:{...(0,o.nv)("auth",{signOut:"signOut"})}};var Ce=(0,k.Z)(we,be,[],!1,null,"09cac679",null);Ce.options.__file="src/pages/Dashboard/MenuFooter.vue";const Se=Ce.exports;var Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"track-card-root"},[s("img",{staticClass:"track-image",attrs:{src:e.imageUrl}}),e._v(" "),s("div",{staticClass:"content"},[s("div",[s("div",{staticClass:"title"},[e._v("\n        "+e._s(e.item.track.name)+"\n      ")]),e._v(" "),s("div",[s("ul",e._l(e.item.track.artists,(function(t){return s("li",{key:t.id,staticClass:"artist"},[e._v("\n            "+e._s(t.name)+"\n          ")])})),0)])]),e._v(" "),s("div",[s("span",{staticClass:"played-at"},[e._v("\n        Played at: "+e._s(e.formattedPlayedAtTimestamp)+"\n      ")])])])])};Te._withStripped=!0;var xe=s(1384);const Me={props:{item:Object},computed:{imageUrl(){return this.item.track.album.images[1].url},formattedPlayedAtTimestamp(){return(0,xe.Z)(new Date(this.item.played_at),"dd MMM yyyy, HH:mm")}}};var Ee=(0,k.Z)(Me,Te,[],!1,null,"7d51262c",null);Ee.options.__file="src/pages/Dashboard/TrackCard.vue";const Le={components:{Layout:ne,ThemeSelector:me,ArtistsList:ke,MenuFooter:Se,TrackCard:Ee.exports},data:()=>({timer:null,recentlyPlayedTracks:null}),computed:{selectedArtistId(){return this.$route.query.artist},recentArtists(){const{recentlyPlayedTracks:e}=this;if(!e)return null;const t=null==e?void 0:e.flatMap((e=>e.track.artists));return L()(t,"id")},displayedTracks(){const{recentlyPlayedTracks:e}=this;if(!e)return null;const{selectedArtistId:t}=this;return t?e.filter((e=>e.track.artists.some((e=>e.id===t)))):e}},created(){this.repeatLoadData()},beforeDestroy(){clearTimeout(this.timer)},methods:{async repeatLoadData(){await this.loadRecentlyPlayedTracks(),this.timer=setTimeout(this.repeatLoadData,3e4)},async loadRecentlyPlayedTracks(){try{const e=await q.getRecentlyPlayedTracks({limit:20});this.recentlyPlayedTracks=e.items}catch(e){J.handle(e)}},onClickPrev(){console.log("prev")},onClickNext(){console.log("next")}}};var De=(0,k.Z)(Le,M,[],!1,null,"fe23c5ba",null);De.options.__file="src/pages/Dashboard/index.vue";const $e=[{path:"/",component:De.exports,beforeEnter:(e,t,s)=>{if(je().state.auth.accessToken)s();else{const t=e.fullPath;s({name:"login",query:{redirect:"/"!==t&&t||void 0}})}}},{path:"/login",name:"login",component:x,beforeEnter:(e,t,s)=>{je().state.auth.accessToken?s("/"):s()}},{path:"/logout",name:"logout",beforeEnter:(e,t,s)=>{je().dispatch("auth/signOut"),s({name:"login",params:{logout:!0}})}},{path:"*",component:w,meta:{resetTheme:!0}}];a.default.use(y.Z);const Re=new y.Z({routes:$e,scrollBehavior:(e,t,s)=>s||(e.hash?{selector:e.hash}:e.name!==t.name?{x:0,y:0}:void 0)}),Oe=Object.freeze({stateKey:void 0,accessToken:void 0,userData:void 0}),Pe={namespaced:!0,state:{...Oe},mutations:p(Object.keys(Oe)),actions:{async refreshUserData(e){let{commit:t}=e;t("setUserData",await q.getCurrentUser())},signOut(e){let{commit:t}=e;t("setAccessToken",void 0),t("setUserData",null)},signIn(e){let{commit:t}=e;const s=ie();t("setStateKey",s);const a=z({response_type:"token",client_id:"e900798eba474a8c8ac4c4373b175d7c",scope:"user-read-recently-played",redirect_uri:"https://inker.github.io/spotify-api-usage-example",state:s});window.location=`https://accounts.spotify.com/authorize?${a}`},async restoreSession(e){let{commit:t,dispatch:s,state:a}=e;try{const{search:e,hash:n}=window.location;if(e){const t=new URLSearchParams(e).get("error");if(t){throw new Error("access_denied"===t?"Access denied":t)}}const r=new URLSearchParams(n.slice(2)),i=r.get("access_token");if(i){const e=r.get("state");if(i&&(!e||e!==a.stateKey))throw new O("Error during authentication");if(t("setStateKey",void 0),!i)return;t("setAccessToken",i),q.setAccessToken(i),await s("refreshUserData"),await Re.push("/")}else{const{accessToken:e}=a;q.setAccessToken(e),await s("refreshUserData")}}catch(e){J.handle(e)}}}},Ze=Object.freeze({position:null,items:[]}),Ie={namespaced:!0,state:{...Ze},mutations:{...p(Object.keys(Ze)),resetState(e){Object.assign(e,Ze)}},actions:{show(e,t){let{commit:s}=e,{items:a,mouseEvent:n}=t;s("setItems",a),s("setPosition",[n.clientX,n.clientY])},reset(e){let{commit:t}=e;t("resetState")}}};var Ae=s(4702);const ze=(e,t)=>(0,Ae.Z)({key:`vuex:${e}`,paths:(null==t?void 0:t.map((t=>[e,t].join("."))))??[e],filter:t=>t.type.startsWith(`${e}/`),getState:(t,s)=>{const a=s.getItem(t);try{const t=JSON.parse(a);return t?{[e]:t}:{}}catch{return{}}},setState:(t,s,a)=>{a.setItem(t,JSON.stringify(s[e]))}}),je=l()((()=>{const e=new o.yh({modules:{appearance:v,sidebar:_,auth:Pe,contextMenu:Ie},plugins:[ze("auth",["stateKey","accessToken"]),ze("appearance",["colorTheme"]),ze("sidebar"),ze("dateTime")]});return(e=>{e.watch((e=>e.auth.accessToken),(e=>{e||a.default.notify({clean:!0})}))})(e),e}));var Ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-root"},[s("Theming"),e._v(" "),s("notifications",{attrs:{group:"global"}}),e._v(" "),s("router-view")],1)};Ue._withStripped=!0;const qe=window.matchMedia("(prefers-color-scheme: dark)"),Be={components:{Theming:{computed:{...(0,o.Se)("appearance",{isDarkMode:"isDarkMode"})},watch:{isDarkMode:{immediate:!0,handler(e){document.body.classList[e?"add":"remove"]("dark-mode")}}},mounted(){this.setSystemTheme(qe.matches),qe.addEventListener("change",this.handleMatchMediaChange)},beforeDestroy(){document.body.classList.remove("dark-mode"),qe.removeEventListener("change",this.handleMatchMediaChange)},methods:{...(0,o.OI)("appearance",["setSystemTheme"]),handleMatchMediaChange(e){this.setSystemTheme(e.matches?"dark":"light")}},render:e=>e()}}};var Ne=(0,k.Z)(Be,Ue,[],!1,null,"3689a55b",null);Ne.options.__file="src/Root.vue";const We=Ne.exports,Je=s.e(872).then(s.t.bind(s,3119,23));a.default.config.productionTip=!1,a.default.use(o.ZP),a.default.use(i.Sy),a.default.use(r()),J.setRouter(Re);const Ke=je();J.setStore(Ke),async function(){await Je,await Ke.dispatch("auth/restoreSession"),new a.default({el:"#app",components:{Root:We},store:Ke,router:Re,template:"<Root/>"})}()}},e=>{e.O(0,[421,485,202,284,736],(()=>{return t=9462,e(e.s=t);var t}));e.O()}]);