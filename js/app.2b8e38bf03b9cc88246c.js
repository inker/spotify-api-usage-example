"use strict";(self.webpackChunkspotify_api_usage_example=self.webpackChunkspotify_api_usage_example||[]).push([[143],{6202:(t,e,s)=>{s(6487);var a=s(538),n=s(4765),r=s.n(n),i=s(266),o=s(629),c=s(1463),l=s.n(c);const u=t=>{return"set"+`${(e=t)[0].toUpperCase()}${e.slice(1)}`;var e},d=t=>(e,s)=>{e[t]=s},m=t=>[u(t),d(t)],p=t=>Object.fromEntries(t.map(m)),h=Object.freeze({colorTheme:"light",systemTheme:null}),v={namespaced:!0,state:{...h},getters:{isDarkMode(t){const{colorTheme:e}=t;return"dark"===e||"auto"===e&&"dark"===t.systemTheme}},mutations:p(Object.keys(h))},_=Object.freeze({x:void 0}),f={namespaced:!0,state:{..._},mutations:{...p(Object.keys(_)),resetState(t){Object.assign(t,_)}}};var g=s(8345),y=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)};y._withStripped=!0;var b=s(1900),k=(0,b.Z)({},y,[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"not-found-root"},[s("div",{staticClass:"not-found-text"},[t._v("\n    Page not found\n  ")])])}],!1,null,"28345dd6",null);k.options.__file="src/pages/NotFound/index.vue";const w=k.exports;var T=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"login-root"},[s("form",{on:{submit:function(e){return e.preventDefault(),t.signIn.apply(null,arguments)}}},[s("LandingButton",{staticClass:"login-button",attrs:{type:"submit"}},[t._v("\n      Sign in via Spotify\n    ")])],1)])};T._withStripped=!0;var S=function(){var t=this,e=t.$createElement;return(t._self._c||e)("button",t._g(t._b({staticClass:"login-button",attrs:{type:t.type}},"button",t.$attrs,!1),t.$listeners),[t._t("default")],2)};S._withStripped=!0;const C={inheritAttrs:!1,props:{type:{type:String,default:"button"}}};var I=(0,b.Z)(C,S,[],!1,null,"486fcdea",null);I.options.__file="src/ui/LandingButton/index.vue";const x={components:{LandingButton:I.exports},methods:{...(0,o.nv)("auth",{signIn:"signIn"})}};var E=(0,b.Z)(x,T,[],!1,null,"2ddd9490",null);E.options.__file="src/pages/Login/index.vue";const O=E.exports;var L=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Layout",{scopedSlots:t._u([{key:"sidebar",fn:function(){return[s("div",{staticClass:"menu-container"},[s("div",{staticClass:"menu-top"},[s("ThemeSelector"),t._v(" "),s("ArtistsList",{attrs:{list:t.recentArtists,selectedId:t.selectedArtistId}})],1),t._v(" "),s("MenuFooter")],1)]},proxy:!0},{key:"content",fn:function(){return[s("div",{staticClass:"content-container"},[t.selectedArtistId?s("router-link",{staticClass:"unselect-link",attrs:{to:{query:{artist:void 0}}}},[t._v("\n        Display all artists\n      ")]):t._e(),t._v(" "),t.displayedTracks?s("fragment",[t.displayedTracks.length>0?s("ul",{staticClass:"track-grid"},t._l(t.displayedTracks,(function(t){return s("li",{key:t.track.id},[s("TrackCard",{attrs:{item:t}})],1)})),0):s("div",[t._v("\n          No tracks found\n        ")])]):t._e(),t._v(" "),s("div",{staticClass:"loading-item"},[t._v("\n        Loading...\n      ")]),t._v(" "),s("div",[s("button",{attrs:{type:"button"},on:{click:t.onClickPrev}},[t._v("\n          Prev\n        ")]),t._v(" "),s("button",{attrs:{type:"button"},on:{click:t.onClickNext}},[t._v("\n          Next\n        ")])])],1)]},proxy:!0}])})};L._withStripped=!0;var M=s(5578),P=s.n(M),R=s(6033),D=s(3092);class $ extends Error{constructor(t){super(t),this.name="RequestError"}}class A extends Error{constructor(t){super(t),this.name="UnauthorizedError"}}var U=s(6604),Z=s.n(U),z=s(4293),N=s.n(z);const j=t=>{if(N()(t))return"";const e=Z()(t,String);return new URLSearchParams(e).toString()};function F(t,e,s){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,s)}const{SPOTIFY_API_HOST:Y}={NODE_ENV:"production",VERSION:"v1.0.0",SPOTIFY_API_HOST:"https://api.spotify.com",SPOTIFY_AUTH_HOST:"https://accounts.spotify.com/authorize",SPOTIFY_CLIENT_ID:"e900798eba474a8c8ac4c4373b175d7c",SPOTIFY_REDIRECT_URI:"https://inker.github.io/spotify-api-usage-example"};var H=new WeakMap;const B=new class{constructor(){F(this,H,{writable:!0,value:void 0})}setAccessToken(t){(0,D.Z)(this,H,t)}async getJson(t,e){const s=e?`${t}?${j(e)}`:t,a=await fetch(s,{headers:{Authorization:`Bearer ${(0,R.Z)(this,H)}`}}),n=await a.json();if(a.ok)return n;if(401===a.status)throw new A(n.error.message);throw new $(n.error.message)}getCurrentUser(){return this.getJson(`${Y}/v1/me`)}getRecentlyPlayedTracks(t){return this.getJson(`${Y}/v1/me/player/recently-played`,t)}};function W(t,e,s){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,s)}var q=new WeakMap,J=new WeakMap;const K=new class{constructor(){W(this,q,{writable:!0,value:void 0}),W(this,J,{writable:!0,value:void 0})}setRouter(t){(0,D.Z)(this,q,t)}setStore(t){(0,D.Z)(this,J,t)}async handle(t){console.error(t),t instanceof A&&((0,R.Z)(this,J).dispatch("auth/signOut"),await(0,R.Z)(this,q).push({name:"login"})),a.default.notify({group:"global",title:"Error",text:t.message})}};var G=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"dashboard-root"},[s("Resize",{model:{value:t.isResizing,callback:function(e){t.isResizing=e},expression:"isResizing"}}),t._v(" "),s("div",{staticClass:"sidebar",style:{width:t.sideBarLeft}},[t._t("sidebar")],2),t._v(" "),s("main",{staticClass:"content",style:{"margin-left":t.sideBarLeft}},[t._t("content")],2)],1)};G._withStripped=!0;var V=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("fragment",[s("GlobalEvents",{on:{mousemove:function(e){return e.stopPropagation(),t.onMouseMove.apply(null,arguments)},mouseup:function(e){return e.stopPropagation(),t.onMouseUp.apply(null,arguments)}}}),t._v(" "),s("GlobalClassList",{attrs:{value:t.globalClass}}),t._v(" "),s("div",{staticClass:"resize-bar",style:{left:t.x},on:{mousedown:t.onMouseDown}})],1)};V._withStripped=!0;var X=s(4691),Q=s.n(X),tt=s(8849),et=s(7361),st=s.n(et);const at={props:{value:String,target:{type:[String,Array],default:()=>["document","body"]}},computed:{targetClassList(){return st()(window,this.target).classList}},watch:{value(t,e){e&&this.targetClassList.remove(e),t&&this.targetClassList.add(t)},target(t,e){window[e].classList.remove(this.value),window[t].classList.add(this.value)}},mounted(){this.value&&this.targetClassList.add(this.value)},beforeDestroy(){this.value&&this.targetClassList.remove(this.value)},render:t=>t()},nt={name:"Resize",components:{GlobalEvents:tt.Z,GlobalClassList:at},props:{value:Boolean},computed:{...(0,o.rn)("sidebar",["x"]),globalClass(){return this.value?"global-resizing":void 0}},methods:{...(0,o.OI)("sidebar",["setX","resetState"]),onMouseDown(){this.$emit("input",!0)},onMouseMove(t){if(!this.value)return;const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=Math.max(.1*e,225),a=.4*e,n=Math.round(Q()(t.clientX,s,a));this.setX(`${n}px`)},onMouseUp(){this.$emit("input",!1)}}};var rt=(0,b.Z)(nt,V,[],!1,null,"92dbdcb4",null);rt.options.__file="src/ui/Resize.vue";const it={components:{Resize:rt.exports},data:()=>({isResizing:!1}),computed:{...(0,o.rn)("sidebar",{sideBarLeft:"x"})}};var ot=(0,b.Z)(it,G,[],!1,null,"50bf451c",null);ot.options.__file="src/ui/Layout.vue";const ct=ot.exports;var lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"theme-selector-root"},[s("Radio",{attrs:{name:t.name,list:t.list,selected:t.colorTheme},on:{input:t.setColorTheme}})],1)};lt._withStripped=!0;const ut=()=>Math.random().toString(36).slice(2);var dt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"radio-root"},t._l(t.list,(function(e){return s("label",{key:e.value,staticClass:"theme-item",class:{selected:e.value===t.selected}},[s("input",{attrs:{type:"radio",name:t.name},domProps:{value:e.value,checked:e.value===t.selected},on:{input:function(s){return t.$emit("input",e.value)}}}),t._v("\n    "+t._s(e.label)+"\n  ")])})),0)};dt._withStripped=!0;const mt={props:{name:String,list:Array,selected:String}};var pt=(0,b.Z)(mt,dt,[],!1,null,"e538135c",null);pt.options.__file="src/ui/ThemeSelector/Radio.vue";const ht={components:{Radio:pt.exports},data:()=>({name:ut(),list:[{value:"light",label:"Light theme"},{value:"dark",label:"Dark theme"},{value:"auto",label:"System theme"}]}),computed:{...(0,o.rn)("appearance",{colorTheme:"colorTheme"})},methods:{...(0,o.OI)("appearance",{setColorTheme:"setColorTheme"})}};var vt=(0,b.Z)(ht,lt,[],!1,null,"1fa4a7c9",null);vt.options.__file="src/ui/ThemeSelector/index.vue";const _t=vt.exports;var ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"artists-title"},[t._v("\n    Recent artists:\n  ")]),t._v(" "),t.list?s("fragment",[t.list.length>0?s("ul",{staticClass:"artist-list"},t._l(t.list,(function(e){return s("li",{key:e.id},[s("router-link",{staticClass:"artist-link",attrs:{to:{query:{artist:e.id}}}},[s("MenuItem",{attrs:{text:e.name,isSelected:e.id===t.selectedId}})],1)],1)})),0):s("MenuItem",{attrs:{text:"No artists found"}})],1):s("MenuItem",{staticClass:"loading-item",attrs:{text:"Loading..."}})],1)};ft._withStripped=!0;var gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"artist-item-root",class:{selected:t.isSelected}},[s("div",{staticClass:"name"},[t._v("\n    "+t._s(t.text)+"\n  ")])])};gt._withStripped=!0;const yt={props:{text:String,isSelected:Boolean}};var bt=(0,b.Z)(yt,gt,[],!1,null,"7f5f6d1e",null);bt.options.__file="src/pages/Dashboard/MenuItem.vue";const kt=bt.exports,wt={components:{MenuItem:kt},props:{list:Array,selectedId:String}};var Tt=(0,b.Z)(wt,ft,[],!1,null,"e658eb8a",null);Tt.options.__file="src/pages/Dashboard/ArtistsList.vue";const St=Tt.exports;var Ct=function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("router-link",{staticClass:"logout-link",attrs:{to:{name:"logout"}}},[e("MenuItem",{attrs:{text:"Sign out"}})],1)],1)};Ct._withStripped=!0;const It={components:{MenuItem:kt},methods:{...(0,o.nv)("auth",{signOut:"signOut"})}};var xt=(0,b.Z)(It,Ct,[],!1,null,"09cac679",null);xt.options.__file="src/pages/Dashboard/MenuFooter.vue";const Et=xt.exports;var Ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"track-card-root"},[s("LazyImage",{staticClass:"track-image",attrs:{src:t.imageUrl}}),t._v(" "),s("div",{staticClass:"content"},[s("div",[s("div",{staticClass:"title"},[t._v("\n        "+t._s(t.item.track.name)+"\n      ")]),t._v(" "),s("div",[s("ul",t._l(t.item.track.artists,(function(e){return s("li",{key:e.id,staticClass:"artist"},[t._v("\n            "+t._s(e.name)+"\n          ")])})),0)])]),t._v(" "),s("div",[s("span",{staticClass:"played-at"},[t._v("\n        Played at: "+t._s(t.formattedPlayedAtTimestamp)+"\n      ")])])])],1)};Ot._withStripped=!0;var Lt=s(1384),Mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.imageUrl?s("img",{attrs:{src:t.imageUrl}}):s("div",{staticClass:"dummy-div"})};Mt._withStripped=!0;const Pt={props:{src:String},data:()=>({imageUrl:void 0}),created(){this.preloadImage()},methods:{async preloadImage(){const t=await(t=>{const e=new Image;return new Promise(((s,a)=>{e.onload=()=>{s(e)},e.onerror=a,e.src=t}))})(this.src);this.imageUrl=t.src}}};var Rt=(0,b.Z)(Pt,Mt,[],!1,null,"4320da76",null);Rt.options.__file="src/ui/LazyImage.vue";const Dt={components:{LazyImage:Rt.exports},props:{item:Object},computed:{imageUrl(){return this.item.track.album.images[1].url},formattedPlayedAtTimestamp(){return(0,Lt.Z)(new Date(this.item.played_at),"dd MMM yyyy, HH:mm")}}};var $t=(0,b.Z)(Dt,Ot,[],!1,null,"7d51262c",null);$t.options.__file="src/pages/Dashboard/TrackCard.vue";const At={components:{Layout:ct,ThemeSelector:_t,ArtistsList:St,MenuFooter:Et,TrackCard:$t.exports},data:()=>({timer:null,recentlyPlayedTracks:null}),computed:{selectedArtistId(){return this.$route.query.artist},recentArtists(){const{recentlyPlayedTracks:t}=this;if(!t)return null;const e=null==t?void 0:t.flatMap((t=>t.track.artists));return P()(e,"id")},displayedTracks(){const{recentlyPlayedTracks:t}=this;if(!t)return null;const{selectedArtistId:e}=this;return e?t.filter((t=>t.track.artists.some((t=>t.id===e)))):t}},created(){this.repeatLoadData()},beforeDestroy(){clearTimeout(this.timer)},methods:{async repeatLoadData(){await this.loadRecentlyPlayedTracks(),this.timer=setTimeout(this.repeatLoadData,3e4)},async loadRecentlyPlayedTracks(){try{const t=await B.getRecentlyPlayedTracks({limit:20});this.recentlyPlayedTracks=t.items}catch(t){K.handle(t)}},onClickPrev(){console.log("prev")},onClickNext(){console.log("next")}}};var Ut=(0,b.Z)(At,L,[],!1,null,"fe23c5ba",null);Ut.options.__file="src/pages/Dashboard/index.vue";const Zt=[{path:"/",component:Ut.exports,beforeEnter:(t,e,s)=>{if(Kt().state.auth.accessToken)s();else{const e=t.fullPath;s({name:"login",query:{redirect:"/"!==e&&e||void 0}})}}},{path:"/login",name:"login",component:O,beforeEnter:(t,e,s)=>{Kt().state.auth.accessToken?s("/"):s()}},{path:"/logout",name:"logout",beforeEnter:(t,e,s)=>{Kt().dispatch("auth/signOut"),s({name:"login",params:{logout:!0}})}},{path:"*",component:w,meta:{resetTheme:!0}}];a.default.use(g.Z);const zt=new g.Z({routes:Zt,scrollBehavior:(t,e,s)=>s||(t.hash?{selector:t.hash}:t.name!==e.name?{x:0,y:0}:void 0)}),{SPOTIFY_AUTH_HOST:Nt,SPOTIFY_CLIENT_ID:jt,SPOTIFY_REDIRECT_URI:Ft}={NODE_ENV:"production",VERSION:"v1.0.0",SPOTIFY_API_HOST:"https://api.spotify.com",SPOTIFY_AUTH_HOST:"https://accounts.spotify.com/authorize",SPOTIFY_CLIENT_ID:"e900798eba474a8c8ac4c4373b175d7c",SPOTIFY_REDIRECT_URI:"https://inker.github.io/spotify-api-usage-example"},Yt=Object.freeze({stateKey:void 0,accessToken:void 0,userData:void 0}),Ht={namespaced:!0,state:{...Yt},mutations:p(Object.keys(Yt)),actions:{async refreshUserData(t){let{commit:e}=t;e("setUserData",await B.getCurrentUser())},signOut(t){let{commit:e}=t;e("setAccessToken",void 0),e("setUserData",null)},signIn(t){let{commit:e}=t;const s=ut();e("setStateKey",s);const a=j({response_type:"token",client_id:jt,scope:"user-read-recently-played",redirect_uri:Ft,state:s});window.location=`${Nt}?${a}`},async restoreSession(t){let{commit:e,dispatch:s,state:a}=t;try{const{search:t,hash:n}=window.location;if(t){const e=new URLSearchParams(t).get("error");if(e){throw new Error("access_denied"===e?"Access denied":e)}}const r=new URLSearchParams(n.slice(2)),i=r.get("access_token");if(i){const t=r.get("state");if(i&&(!t||t!==a.stateKey))throw new A("Error during authentication");if(e("setStateKey",void 0),!i)return;e("setAccessToken",i),B.setAccessToken(i),await s("refreshUserData"),await zt.push("/")}else{const{accessToken:t}=a;B.setAccessToken(t),await s("refreshUserData")}}catch(t){K.handle(t)}}}},Bt=Object.freeze({position:null,items:[]}),Wt={namespaced:!0,state:{...Bt},mutations:{...p(Object.keys(Bt)),resetState(t){Object.assign(t,Bt)}},actions:{show(t,e){let{commit:s}=t,{items:a,mouseEvent:n}=e;s("setItems",a),s("setPosition",[n.clientX,n.clientY])},reset(t){let{commit:e}=t;e("resetState")}}};var qt=s(4702);const Jt=(t,e)=>(0,qt.Z)({key:`vuex:${t}`,paths:(null==e?void 0:e.map((e=>[t,e].join("."))))??[t],filter:e=>e.type.startsWith(`${t}/`),getState:(e,s)=>{const a=s.getItem(e);try{const e=JSON.parse(a);return e?{[t]:e}:{}}catch{return{}}},setState:(e,s,a)=>{a.setItem(e,JSON.stringify(s[t]))}}),Kt=l()((()=>{const t=new o.yh({modules:{appearance:v,sidebar:f,auth:Ht,contextMenu:Wt},plugins:[Jt("auth",["stateKey","accessToken"]),Jt("appearance",["colorTheme"]),Jt("sidebar"),Jt("dateTime")]});return(t=>{t.watch((t=>t.auth.accessToken),(t=>{t||a.default.notify({clean:!0})}))})(t),t}));var Gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-root"},[s("Theming"),t._v(" "),s("notifications",{attrs:{group:"global"}}),t._v(" "),s("router-view")],1)};Gt._withStripped=!0;const Vt=window.matchMedia("(prefers-color-scheme: dark)"),Xt={components:{Theming:{computed:{...(0,o.Se)("appearance",{isDarkMode:"isDarkMode"})},watch:{isDarkMode:{immediate:!0,handler(t){document.body.classList[t?"add":"remove"]("dark-mode")}}},mounted(){this.setSystemTheme(Vt.matches),Vt.addEventListener("change",this.handleMatchMediaChange)},beforeDestroy(){document.body.classList.remove("dark-mode"),Vt.removeEventListener("change",this.handleMatchMediaChange)},methods:{...(0,o.OI)("appearance",["setSystemTheme"]),handleMatchMediaChange(t){this.setSystemTheme(t.matches?"dark":"light")}},render:t=>t()}}};var Qt=(0,b.Z)(Xt,Gt,[],!1,null,"3689a55b",null);Qt.options.__file="src/Root.vue";const te=Qt.exports,ee=s.e(872).then(s.t.bind(s,3119,23));a.default.config.productionTip=!1,a.default.use(o.ZP),a.default.use(i.Sy),a.default.use(r()),K.setRouter(zt);const se=Kt();K.setStore(se),async function(){await ee,await se.dispatch("auth/restoreSession"),new a.default({el:"#app",components:{Root:te},store:se,router:zt,template:"<Root/>"})}()}},t=>{t.O(0,[421,485,202,284,736],(()=>{return e=6202,t(t.s=e);var e}));t.O()}]);