"use strict";(self.webpackChunkspotify_api_usage_example=self.webpackChunkspotify_api_usage_example||[]).push([[143],{7237:(t,e,s)=>{s(6487);var a=s(538),n=s(4765),r=s.n(n),i=s(266),o=s(629),l=s(1463),c=s.n(l);const u=t=>{return"set"+`${(e=t)[0].toUpperCase()}${e.slice(1)}`;var e},d=t=>(e,s)=>{e[t]=s},p=t=>[u(t),d(t)],m=t=>Object.fromEntries(t.map(p)),h=Object.freeze({colorTheme:"light",systemTheme:null}),v={namespaced:!0,state:{...h},getters:{isDarkMode(t){const{colorTheme:e}=t;return"dark"===e||"auto"===e&&"dark"===t.systemTheme}},mutations:m(Object.keys(h))},f=Object.freeze({x:void 0}),_={namespaced:!0,state:{...f},mutations:{...m(Object.keys(f)),resetState(t){Object.assign(t,f)}}};var y=s(8345),g=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)};g._withStripped=!0;var k=s(1900),b=(0,k.Z)({},g,[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"not-found-root"},[s("div",{staticClass:"not-found-text"},[t._v("\n    Page not found\n  ")])])}],!1,null,"28345dd6",null);b.options.__file="src/pages/NotFound/index.vue";const w=b.exports;var C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"login-root"},[s("form",{on:{submit:function(e){return e.preventDefault(),t.signIn.apply(null,arguments)}}},[s("LandingButton",{staticClass:"login-button",attrs:{type:"submit"}},[t._v("\n      Sign in via Spotify\n    ")])],1)])};C._withStripped=!0;var S=function(){var t=this,e=t.$createElement;return(t._self._c||e)("button",t._g(t._b({staticClass:"login-button",attrs:{type:t.type}},"button",t.$attrs,!1),t.$listeners),[t._t("default")],2)};S._withStripped=!0;const T={inheritAttrs:!1,props:{type:{type:String,default:"button"}}};var x=(0,k.Z)(T,S,[],!1,null,"486fcdea",null);x.options.__file="src/ui/LandingButton/index.vue";const M={components:{LandingButton:x.exports},methods:{...(0,o.nv)("auth",{signIn:"signIn"})}};var L=(0,k.Z)(M,C,[],!1,null,"2ddd9490",null);L.options.__file="src/pages/Login/index.vue";const E=L.exports;var $=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Layout",{scopedSlots:t._u([{key:"sidebar",fn:function(){return[s("div",{staticClass:"menu-container"},[s("div",{staticClass:"menu-top"},[s("ThemeSelector"),t._v(" "),s("ArtistsList",{attrs:{list:t.recentArtists,selectedId:t.selectedArtistId}})],1),t._v(" "),s("MenuFooter")],1)]},proxy:!0},{key:"content",fn:function(){return[s("div",{staticClass:"content-container"},[t.selectedArtistId?s("router-link",{staticClass:"unselect-link",attrs:{to:{query:{artist:void 0}}}},[t._v("\n        Display all artists\n      ")]):t._e(),t._v(" "),t.displayedTracks?s("fragment",[t.displayedTracks.length>0?s("ul",{staticClass:"track-grid"},t._l(t.displayedTracks,(function(t){return s("li",{key:t.track.id},[s("TrackCard",{attrs:{item:t}})],1)})),0):s("div",[t._v("\n          No tracks found\n        ")])]):t._e(),t._v(" "),s("div",[s("button",{attrs:{type:"button"},on:{click:t.onClickPrev}},[t._v("\n          Prev\n        ")]),t._v(" "),s("button",{attrs:{type:"button"},on:{click:t.onClickNext}},[t._v("\n          Next\n        ")])])],1)]},proxy:!0}])})};$._withStripped=!0;var D=s(5578),R=s.n(D),Z=s(6033),O=s(3092);class P extends Error{constructor(t){super(t),this.name="RequestError"}}class A extends Error{constructor(t){super(t),this.name="UnauthorizedError"}}var I=s(6604),z=s.n(I),j=s(4293),U=s.n(j);const B=t=>{if(U()(t))return"";const e=z()(t,String);return new URLSearchParams(e).toString()};function q(t,e,s){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,s)}var N=new WeakMap;const W=new class{constructor(){q(this,N,{writable:!0,value:void 0})}setAccessToken(t){(0,O.Z)(this,N,t)}async requestJson(t,e){const s=e?`${t}?${B(e)}`:t,a=await fetch(s,{headers:{Authorization:`Bearer ${(0,Z.Z)(this,N)}`}}),n=await a.json();if(a.ok)return n;if(401===a.status)throw new A(n.error.message);throw new P(n.error.message)}getCurrentUser(){return this.requestJson("https://api.spotify.com/v1/me")}getRecentlyPlayedTracks(t){return this.requestJson("https://api.spotify.com/v1/me/player/recently-played",t)}};function J(t,e,s){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,s)}var K=new WeakMap,F=new WeakMap;const G=new class{constructor(){J(this,K,{writable:!0,value:void 0}),J(this,F,{writable:!0,value:void 0})}setRouter(t){(0,O.Z)(this,K,t)}setStore(t){(0,O.Z)(this,F,t)}async handle(t){console.error(t),t instanceof A&&((0,Z.Z)(this,F).dispatch("auth/signOut"),await(0,Z.Z)(this,K).push({name:"login"})),a.default.notify({group:"global",title:"Error",text:t.message})}};var X=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"dashboard-root"},[s("Resize",{model:{value:t.isResizing,callback:function(e){t.isResizing=e},expression:"isResizing"}}),t._v(" "),s("div",{staticClass:"sidebar",style:{width:t.sideBarLeft}},[t._t("sidebar")],2),t._v(" "),s("main",{staticClass:"content",style:{"margin-left":t.sideBarLeft}},[t._t("content")],2)],1)};X._withStripped=!0;var H=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("fragment",[s("GlobalEvents",{on:{mousemove:function(e){return e.stopPropagation(),t.onMouseMove.apply(null,arguments)},mouseup:function(e){return e.stopPropagation(),t.onMouseUp.apply(null,arguments)}}}),t._v(" "),s("GlobalClassList",{attrs:{value:t.globalClass}}),t._v(" "),s("div",{staticClass:"resize-bar",style:{left:t.x},on:{mousedown:t.onMouseDown}})],1)};H._withStripped=!0;var Y=s(4691),Q=s.n(Y),V=s(8849),tt=s(7361),et=s.n(tt);const st={props:{value:String,target:{type:[String,Array],default:()=>["document","body"]}},computed:{targetClassList(){return et()(window,this.target).classList}},watch:{value(t,e){e&&this.targetClassList.remove(e),t&&this.targetClassList.add(t)},target(t,e){window[e].classList.remove(this.value),window[t].classList.add(this.value)}},mounted(){this.value&&this.targetClassList.add(this.value)},beforeDestroy(){this.value&&this.targetClassList.remove(this.value)},render:t=>t()},at={name:"Resize",components:{GlobalEvents:V.Z,GlobalClassList:st},props:{value:Boolean},computed:{...(0,o.rn)("sidebar",["x"]),globalClass(){return this.value?"global-resizing":void 0}},methods:{...(0,o.OI)("sidebar",["setX","resetState"]),onMouseDown(){this.$emit("input",!0)},onMouseMove(t){if(!this.value)return;const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=Math.max(.1*e,225),a=.4*e,n=Math.round(Q()(t.clientX,s,a));this.setX(`${n}px`)},onMouseUp(){this.$emit("input",!1)}}};var nt=(0,k.Z)(at,H,[],!1,null,"92dbdcb4",null);nt.options.__file="src/ui/Resize.vue";const rt={components:{Resize:nt.exports},data:()=>({isResizing:!1}),computed:{...(0,o.rn)("sidebar",{sideBarLeft:"x"})}};var it=(0,k.Z)(rt,X,[],!1,null,"50bf451c",null);it.options.__file="src/ui/Layout.vue";const ot=it.exports;var lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"theme-selector-root"},[s("Radio",{attrs:{name:t.name,list:t.list,selected:t.colorTheme},on:{input:t.setColorTheme}})],1)};lt._withStripped=!0;const ct=()=>Math.random().toString(36).slice(2);var ut=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"radio-root"},t._l(t.list,(function(e){return s("label",{key:e.value,staticClass:"theme-item",class:{selected:e.value===t.selected}},[s("input",{attrs:{type:"radio",name:t.name},domProps:{value:e.value,checked:e.value===t.selected},on:{input:function(s){return t.$emit("input",e.value)}}}),t._v("\n    "+t._s(e.label)+"\n  ")])})),0)};ut._withStripped=!0;const dt={props:{name:String,list:Array,selected:String}};var pt=(0,k.Z)(dt,ut,[],!1,null,"e538135c",null);pt.options.__file="src/ui/ThemeSelector/Radio.vue";const mt={components:{Radio:pt.exports},data:()=>({name:ct(),list:[{value:"light",label:"Light theme"},{value:"dark",label:"Dark theme"},{value:"auto",label:"System theme"}]}),computed:{...(0,o.rn)("appearance",{colorTheme:"colorTheme"})},methods:{...(0,o.OI)("appearance",{setColorTheme:"setColorTheme"})}};var ht=(0,k.Z)(mt,lt,[],!1,null,"1fa4a7c9",null);ht.options.__file="src/ui/ThemeSelector/index.vue";const vt=ht.exports;var ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"artists-title"},[t._v("\n    Recently played artists:\n  ")]),t._v(" "),t.list?s("ul",{staticClass:"artist-list"},t._l(t.list,(function(e){return s("li",{key:e.id},[s("router-link",{staticClass:"artist-link",attrs:{to:{query:{artist:e.id}}}},[s("MenuItem",{attrs:{text:e.name,isSelected:e.id===t.selectedId}})],1)],1)})),0):t._e()])};ft._withStripped=!0;var _t=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"artist-item-root",class:{selected:t.isSelected}},[s("div",{staticClass:"name"},[t._v("\n    "+t._s(t.text)+"\n  ")])])};_t._withStripped=!0;const yt={props:{text:String,isSelected:Boolean}};var gt=(0,k.Z)(yt,_t,[],!1,null,"7f5f6d1e",null);gt.options.__file="src/pages/Dashboard/MenuItem.vue";const kt=gt.exports,bt={components:{MenuItem:kt},props:{list:Array,selectedId:String}};var wt=(0,k.Z)(bt,ft,[],!1,null,"e658eb8a",null);wt.options.__file="src/pages/Dashboard/ArtistsList.vue";const Ct=wt.exports;var St=function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("router-link",{staticClass:"logout-link",attrs:{to:{name:"logout"}}},[e("MenuItem",{attrs:{text:"Sign out"}})],1)],1)};St._withStripped=!0;const Tt={components:{MenuItem:kt},methods:{...(0,o.nv)("auth",{signOut:"signOut"})}};var xt=(0,k.Z)(Tt,St,[],!1,null,"09cac679",null);xt.options.__file="src/pages/Dashboard/MenuFooter.vue";const Mt=xt.exports;var Lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"track-card-root"},[s("img",{staticClass:"track-image",attrs:{src:t.imageUrl}}),t._v(" "),s("div",{staticClass:"content"},[s("div",[s("div",{staticClass:"title"},[t._v("\n        "+t._s(t.item.track.name)+"\n      ")]),t._v(" "),s("div",[s("ul",t._l(t.item.track.artists,(function(e){return s("li",{key:e.id,staticClass:"artist"},[t._v("\n            "+t._s(e.name)+"\n          ")])})),0)])]),t._v(" "),s("div",[s("span",{staticClass:"played-at"},[t._v("\n        Played at: "+t._s(t.formattedPlayedAtTimestamp)+"\n      ")])])])])};Lt._withStripped=!0;var Et=s(1384);const $t={props:{item:Object},computed:{imageUrl(){return this.item.track.album.images[1].url},formattedPlayedAtTimestamp(){return(0,Et.Z)(new Date(this.item.played_at),"dd MMM yyyy, HH:mm")}}};var Dt=(0,k.Z)($t,Lt,[],!1,null,"7d51262c",null);Dt.options.__file="src/pages/Dashboard/TrackCard.vue";const Rt={components:{Layout:ot,ThemeSelector:vt,ArtistsList:Ct,MenuFooter:Mt,TrackCard:Dt.exports},data:()=>({timer:null,recentlyPlayedTracks:null}),computed:{selectedArtistId(){return this.$route.query.artist},recentArtists(){const{recentlyPlayedTracks:t}=this;if(!t)return null;const e=null==t?void 0:t.flatMap((t=>t.track.artists));return R()(e,"id")},displayedTracks(){const{recentlyPlayedTracks:t}=this;if(!t)return null;const{selectedArtistId:e}=this;return e?t.filter((t=>t.track.artists.some((t=>t.id===e)))):t}},created(){this.repeatLoadData()},beforeDestroy(){clearTimeout(this.timer)},methods:{async repeatLoadData(){await this.loadRecentlyPlayedTracks(),this.timer=setTimeout(this.repeatLoadData,3e4)},async loadRecentlyPlayedTracks(){try{const t=await W.getRecentlyPlayedTracks({limit:20});this.recentlyPlayedTracks=t.items}catch(t){G.handle(t)}},onClickPrev(){console.log("prev")},onClickNext(){console.log("next")}}};var Zt=(0,k.Z)(Rt,$,[],!1,null,"fe23c5ba",null);Zt.options.__file="src/pages/Dashboard/index.vue";const Ot=[{path:"/",component:Zt.exports,beforeEnter:(t,e,s)=>{if(qt().state.auth.accessToken)s();else{const e=t.fullPath;s({name:"login",query:{redirect:"/"!==e&&e||void 0}})}}},{path:"/login",name:"login",component:E,beforeEnter:(t,e,s)=>{qt().state.auth.accessToken?s("/"):s()}},{path:"/logout",name:"logout",beforeEnter:(t,e,s)=>{qt().dispatch("auth/signOut"),s({name:"login",params:{logout:!0}})}},{path:"*",component:w,meta:{resetTheme:!0}}];a.default.use(y.Z);const Pt=new y.Z({routes:Ot,scrollBehavior:(t,e,s)=>s||(t.hash?{selector:t.hash}:t.name!==e.name?{x:0,y:0}:void 0)}),At=Object.freeze({stateKey:void 0,accessToken:void 0,userData:void 0}),It={namespaced:!0,state:{...At},mutations:m(Object.keys(At)),actions:{async refreshUserData(t){let{commit:e}=t;e("setUserData",await W.getCurrentUser())},signOut(t){let{commit:e}=t;e("setAccessToken",void 0),e("setUserData",null)},signIn(t){let{commit:e}=t;const s=ct();e("setStateKey",s);const a=B({response_type:"token",client_id:"e900798eba474a8c8ac4c4373b175d7c",scope:"user-read-recently-played",redirect_uri:"https://inker.github.io/spotify-api-usage-example",state:s});window.location=`https://accounts.spotify.com/authorize?${a}`},async restoreSession(t){let{commit:e,dispatch:s,state:a}=t;try{const{search:t,hash:n}=window.location;if(t){const e=new URLSearchParams(t).get("error");if(e){throw new Error("access_denied"===e?"Access denied":e)}}const r=new URLSearchParams(n.slice(2)),i=r.get("access_token");if(i){const t=r.get("state");if(i&&(!t||t!==a.stateKey))throw new A("Error during authentication");if(e("setStateKey",void 0),!i)return;e("setAccessToken",i),W.setAccessToken(i),await s("refreshUserData"),await Pt.push("/")}else{const{accessToken:t}=a;W.setAccessToken(t),await s("refreshUserData")}}catch(t){G.handle(t)}}}},zt=Object.freeze({position:null,items:[]}),jt={namespaced:!0,state:{...zt},mutations:{...m(Object.keys(zt)),resetState(t){Object.assign(t,zt)}},actions:{show(t,e){let{commit:s}=t,{items:a,mouseEvent:n}=e;s("setItems",a),s("setPosition",[n.clientX,n.clientY])},reset(t){let{commit:e}=t;e("resetState")}}};var Ut=s(4702);const Bt=(t,e)=>(0,Ut.Z)({key:`vuex:${t}`,paths:(null==e?void 0:e.map((e=>[t,e].join("."))))??[t],filter:e=>e.type.startsWith(`${t}/`),getState:(e,s)=>{const a=s.getItem(e);try{const e=JSON.parse(a);return e?{[t]:e}:{}}catch{return{}}},setState:(e,s,a)=>{a.setItem(e,JSON.stringify(s[t]))}}),qt=c()((()=>{const t=new o.yh({modules:{appearance:v,sidebar:_,auth:It,contextMenu:jt},plugins:[Bt("auth",["stateKey","accessToken"]),Bt("appearance",["colorTheme"]),Bt("sidebar"),Bt("dateTime")]});return(t=>{t.watch((t=>t.auth.accessToken),(t=>{t||a.default.notify({clean:!0})}))})(t),t}));var Nt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-root"},[s("Theming"),t._v(" "),s("notifications",{attrs:{group:"global"}}),t._v(" "),s("router-view")],1)};Nt._withStripped=!0;const Wt=window.matchMedia("(prefers-color-scheme: dark)"),Jt={components:{Theming:{computed:{...(0,o.Se)("appearance",{isDarkMode:"isDarkMode"})},watch:{isDarkMode:{immediate:!0,handler(t){document.body.classList[t?"add":"remove"]("dark-mode")}}},mounted(){this.setSystemTheme(Wt.matches),Wt.addEventListener("change",this.handleMatchMediaChange)},beforeDestroy(){document.body.classList.remove("dark-mode"),Wt.removeEventListener("change",this.handleMatchMediaChange)},methods:{...(0,o.OI)("appearance",["setSystemTheme"]),handleMatchMediaChange(t){this.setSystemTheme(t.matches?"dark":"light")}},render:t=>t()}}};var Kt=(0,k.Z)(Jt,Nt,[],!1,null,"3689a55b",null);Kt.options.__file="src/Root.vue";const Ft=Kt.exports,Gt=s.e(872).then(s.t.bind(s,3119,23));a.default.config.productionTip=!1,a.default.use(o.ZP),a.default.use(i.Sy),a.default.use(r()),G.setRouter(Pt);const Xt=qt();G.setStore(Xt),async function(){await Gt,await Xt.dispatch("auth/restoreSession"),new a.default({el:"#app",components:{Root:Ft},store:Xt,router:Pt,template:"<Root/>"})}()}},t=>{t.O(0,[421,485,202,284,736],(()=>{return e=7237,t(t.s=e);var e}));t.O()}]);